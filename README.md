# Шифры перестановки

Данный репозиторий содержит код системы, предназначенной для шифрования и расшифрования сообщений при помощи набора шифров перестановки.

## Сборка и запуск

Для сборки проекта вам понадобится компилятор языка `Rust`. Проще всего воспользоваться поставляемой с ним системой сборки `cargo`, прописав в корне проекта:
```
cargo build --release
```
В резульатате в директории `target` будет создан исполняемый файл, который можно в дальнейшем запустить. Кроме того, можно сразу скомпилировать и запустить, прописав:
```
cargo run --release
```

## Взаимодействие с системой

Для взаимодействия используется собственный микро-язык. При запуске программы без аргументов пользователю предоставляется возможность для ввода команд интерпретатору. Также можно использовать файл с командами, передав путь к нему в качестве аргумента при запуске.

| команда                                                                                                       | описание                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `DATABASE "filename.db"`                                                                                      | создание или выбор базы данных. Дополнительно можно указать, что база должна быть обязательно создана (`CREATE DATABASE "keys.db"`) или что нужно обязательно использовать существующую базу (`LOAD DATABASE "keys.db"`)                                        |
| `SAVE`                                                                                                        | Позволяет сохранить изменения, внесённые в базу данных во время работы                                                                                                                                                                                          |
| `LIST`                                                                                                        | Позволяет перечислить названия систем шифрования, хранимых в базе                                                                                                                                                                                               |
| `RELOAD`                                                                                                      | Позволяет перезагрузить базу данных с диска. Внесённые изменения при этом будут утеряны                                                                                                                                                                         |
| `DESCRIBE "Alice"`                                                                                            | Позволяет получить полную информацию о конкретной системе шифрования - используемые шифры, для каждого шифра способ работы с последним блоком и элемент                                                                                                         |
| `ENCRYPT (FROM "file.txt" \| "string data") WITH "Alice" [INTO "out.bin"]`                                    | Позволяет зашифровать сообщение, загруженное из файла (`FROM "file.txt"`) или переданное в виде строки (`"string data"`), при помощи заданной системы (`"Alice"`) и вывести результат в файл (`INTO "out.bin"`) или на консоль (при отсутствии указания `INTO`) |
| `DECRYPT (FROM "file.txt" \| [sizes] [byte data]  \| [sizes] "string data") WITH "Alice" [INTO "output.txt"]` | Позволяет расшифровать сообщение полученное из источника (файл, бинарный ввод или текст) заданным ключом и записать на консоль или в файл                                                                                                                       |
| `DELETE "Alice"`                                                                                              | Удалить ключ с заданным именем                                                                                                                                                                                                                                  |
| `ADD "Bob" AS ([шифр1, шифр2...] \| шифр)`                                                                    | добавить систему с указаным именем и заданными шифрами (см далее)                                                                                                                                                                                               |
| `EXIT`                                                                                                        | выйти из системы. Замечание: несохранённые изменения будут потеряны                                                                                                                                                                                             |

## Шифры

Каждый шифр задаются тройкой <работа с последним блоком, элемент, алгоритм>. Описать шифр при вводе можно, описав все его параметры, например : `PADDING CHAR PERMUTATION(1, 3, 0, 2)`

Работа с последним блоком:

* С добавлением pad-значения. Задаётся как `PADDING` 
* Без добавления pad-значения. Задаётся как `UNPADDING`

Элемент:

* Бит. Задаётся как `BIT`. Правильная работа алгоритма в случае работы с битами гарантируется при размере блока шифрования, кратном 8 (то есть не преводящая к созданию дополнительных бит, из которых нельзя составить полноценный байт).
* Байт. Задаётся как `BYTE`. Замечание: хотя мы шифруем текст, не все байтовые последовательности, которые можно получить в результате, являются текстом.
* Символ. Задаётся как `CHAR`.
* Группа символов. Задаётся как `GROUP(N)`, где `N` - число символов в группе. При работе с группами нужно следить за тем, что обрабатываемую последовательность можно впринципе разбить на такие группы.

Замечание: Алгоритмы, работающие с символами и группами символов не всегда возможно использовать после битовых и байтовых, так как последние могут создать последовательности байт, не являющимися валидным текстом.

Шифр:
* Простая перестановка. Задаётся как `PERMUTATION(i_1, i_2, ..., i_N)`, например `PERMUTATION(1, 2, 3, 0)`. При желании можно сгенерировать случайную, прописав `PERMUTATION(GENERATED(N))`, где `N` - размер перестановки.
* Вертикальная перестановка. Задаётся числом строк `M`, числом столбцов `N` и перестановкой `[i_1 ... i_n]` как `VERTICAL(M, N, [i_1 ... i_N])`, например `VERTICAL(2, 4, [1, 2, 0, 3])`. Можно сгенерировать случайную как `VERTICAL(GENERATED)`.
* Rail Fence. Задаётся числом строк `M` и числом столбцов `N` как `RAILFENCE(M, N)`, например `RAILFENCE(10, 16)`. Можно сгенерировать случайную через `RAILFENCE(GENERATED)`.

